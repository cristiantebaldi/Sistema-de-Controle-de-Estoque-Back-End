CREATE TABLE produto (

	id SERIAL PRIMARY KEY,
	nome VARCHAR (30) NOT NULL,
	preco REAL NOT NULL,
	quantidade INTEGER

);

CREATE TABLE venda (

	id SERIAL PRIMARY KEY,
	data_compra TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);

CREATE TABLE venda_produto (

	id SERIAL PRIMARY KEY,
	id_venda INTEGER NOT NULL,
	id_produto INTEGER NOT NULL,
	quantidade INTEGER NOT NULL,
	
	FOREIGN KEY (id_venda) REFERENCES venda (id),
	FOREIGN KEY (id_produto) REFERENCES produto (id)

);

CREATE TABLE balanco (
	id SERIAL PRIMARY KEY
	id_produto INTEGER NOT NULL,
	quantidade INTEGER NOT NULL,
	tipo VARCHAR (60),

	FOREIGN KEY (id_produto) REFERENCES produto (id)
);


SELECT p.nome AS produto, SUM (vp.quantidade) * p.preco AS total_arrecadado, SUM (vp.quantidade) AS quantidade_vendida, p.quantidade AS total_estoque FROM produto p 
INNER JOIN venda_produto vp ON vp.id_produto = p.id
INNER JOIN venda v ON v.id = vp.id_venda
WHERE v.data_compra >= CURRENT_DATE - INTERVAL '8 days'
GROUP BY p.id
ORDER BY quantidade_vendida DESC;
 
SELECT v.id AS id_venda, p.nome AS nome_produto, v.data_compra AS data_venda, vp.quantidade FROM produto p 
INNER JOIN venda_produto vp ON p.id = vp.id_produto
INNER JOIN venda v ON vp.id_venda = v.id;

ALTER TABLE produto ADD COLUMN quantidade_min INTEGER;  

SELECT p.nome AS produto, SUM (vp.quantidade) * p.preco AS total_arrecadado, SUM (vp.quantidade) AS quantidade_vendida, p.quantidade AS total_estoque FROM produto p 
INNER JOIN venda_produto vp ON vp.id_produto = p.id
INNER JOIN venda v ON v.id = vp.id_venda
WHERE v.data_compra between '2024-11-01' and '2024-11-06'
GROUP BY p.id
ORDER BY quantidade_vendida DESC;

SELECT v.id AS id_venda, p.nome AS produto, v.data_compra AS data_venda, SUM (vp.quantidade) * p.preco AS total_arrecadado, SUM (vp.quantidade) AS quantidade_vendida, p.quantidade AS total_estoque FROM produto p 
INNER JOIN venda_produto vp ON vp.id_produto = p.id
INNER JOIN venda v ON v.id = vp.id_venda
WHERE v.data_compra >= '2024-11-01'
GROUP BY p.id, v.data_compra, v.id
ORDER BY quantidade_vendida DESC;